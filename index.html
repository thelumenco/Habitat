<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habitat</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 10 L85 30 L85 70 L50 90 L15 70 L15 30 Z' stroke='%230f172a' stroke-width='3' fill='none'/%3E%3Cpath d='M50 25 L75 40 L75 60 L50 75 L25 60 L25 40 Z' stroke='%230f172a' stroke-width='3' fill='none'/%3E%3C/svg%3E">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e7e5e4 50%, #d6d3d1 100%);
      min-height: 100vh;
      padding: 16px;
      color: #0f172a;
    }
    #loading { 
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #f8fafc 0%, #e7e5e4 50%, #d6d3d1 100%);
      z-index: 9999;
    }
    #app { display: none; }
    #app.loaded { display: block; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { 
      border: 2px solid #cbd5e1; 
      border-top-color: #0f172a; 
      width: 48px; 
      height: 48px; 
      animation: spin 1s linear infinite; 
      margin-bottom: 16px;
    }
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
    .confetti {
      position: fixed;
      width: 8px;
      height: 8px;
      background: #fbbf24;
      pointer-events: none;
      z-index: 9999;
    }
    .confetti.square { transform: rotate(45deg); }
    @keyframes celebrationPop {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1) translateY(-40px); opacity: 0; }
    }
    .celebration-message {
      position: fixed;
      font-size: 14px;
      font-weight: 300;
      letter-spacing: 0.05em;
      color: #0f172a;
      pointer-events: none;
      z-index: 9999;
      animation: celebrationPop 1s ease-out forwards;
    }
    #confettiContainer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
    }
    .loading-text { 
      color: #64748b; 
      font-weight: 300; 
      letter-spacing: 0.1em; 
      text-transform: uppercase; 
      font-size: 12px; 
    }
    .container { max-width: 672px; margin: 0 auto; position: relative; }
    .header {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      border: 1px solid #e2e8f0;
      padding: 32px;
      margin-bottom: 32px;
      position: relative;
      z-index: 10;
    }
    .header::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 128px;
      height: 128px;
      border-left: 2px solid #e2e8f0;
      border-bottom: 2px solid #e2e8f0;
    }
    .header-content { display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1; }
    .title { font-size: 28px; font-weight: 300; letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 4px; display: flex; align-items: center; gap: 6px; }
    .title strong { font-weight: 400; }
    .logo-icon {
      display: inline-block;
      width: 28px;
      height: 28px;
      position: relative;
      top: -1px;
      cursor: pointer;
      transition: transform 0.1s;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
    }
    .logo-icon svg {
      width: 100%;
      height: 100%;
    }
    .logo-icon.spinning-cw {
      animation: logoSpinCW 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .logo-icon.spinning-ccw {
      animation: logoSpinCCW 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .logo-icon.gentle-spin {
      animation: logoGentleSpin 2s ease-in-out;
    }
    @keyframes logoSpinCW {
      from { transform: rotate(0deg); }
      to { transform: rotate(1080deg); }
    }
    @keyframes logoSpinCCW {
      from { transform: rotate(0deg); }
      to { transform: rotate(-1080deg); }
    }
    @keyframes logoGentleSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(180deg); }
    }
    @keyframes personLook {
      0%, 100% { transform: translateX(0px); }
      25% { transform: translateX(-2px); }
      50% { transform: translateX(0px); }
      75% { transform: translateX(2px); }
    }
    .vision-person {
      display: inline-block;
      animation: personLook 4s ease-in-out infinite;
    }
    .subtitle { font-size: 10px; color: #64748b; letter-spacing: 0.1em; text-transform: uppercase; line-height: 1.8; }
    .points-box { position: relative; }
    .points-bg { position: absolute; inset: -4px; background: linear-gradient(135deg, #cbd5e1, #94a3b8); z-index: 0; }
    .points-inner { background: linear-gradient(135deg, #1e293b, #0f172a); color: white; padding: 16px 32px; position: relative; z-index: 1; }
    .points-value { font-size: 28px; font-weight: 300; letter-spacing: 0.05em; }
    .points-label { font-size: 10px; opacity: 0.7; letter-spacing: 0.1em; text-transform: uppercase; }
    
    .settings-container {
      position: relative;
      margin-left: 0;
      margin-top: 12px;
    }
    .settings-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 20px;
      color: #64748b;
    }
    .settings-icon:hover {
      color: #0f172a;
    }
    .settings-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 9998;
    }
    .settings-overlay.open {
      opacity: 1;
      visibility: visible;
    }
    .settings-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 280px;
      max-width: 80vw;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-left: 1px solid #e2e8f0;
      transform: translateX(100%);
      transition: transform 0.3s;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .settings-panel.open {
      transform: translateX(0);
    }
    .settings-header {
      padding: 24px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .settings-title {
      font-weight: 300;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-size: 14px;
      color: #0f172a;
    }
    .close-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 20px;
      color: #64748b;
      transition: all 0.2s;
    }
    .close-btn:hover {
      color: #0f172a;
    }
    .settings-content {
      padding: 24px;
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }
    .settings-btn {
      width: 100%;
      padding: 16px;
      margin-bottom: 12px;
      background: rgba(255,255,255,0.8);
      border: 1px solid #cbd5e1;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 300;
      font-size: 12px;
      letter-spacing: 0.05em;
      color: #1e293b;
      text-align: left;
    }
    .settings-btn:hover {
      border-color: #0f172a;
      background: rgba(255,255,255,1);
    }
    .settings-btn .emoji {
      font-size: 16px;
    }
    .help-content {
      display: none;
      padding: 24px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      margin-top: 16px;
      margin-bottom: 16px;
      font-size: 13px;
      line-height: 1.8;
      color: #475569;
    }
    .help-content.show {
      display: block;
    }
    .help-section {
      margin-bottom: 20px;
    }
    .help-section:last-child {
      margin-bottom: 0;
    }
    .help-title {
      font-weight: 400;
      font-size: 11px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #0f172a;
      margin-bottom: 8px;
    }
    .help-text {
      font-weight: 300;
      font-size: 12px;
      line-height: 1.7;
      color: #475569;
    }
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 10000;
      padding: 16px;
    }
    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border: 1px solid #e2e8f0;
      max-width: 400px;
      width: 100%;
      padding: 32px 24px 24px;
      transform: scale(0.95);
      transition: transform 0.3s;
    }
    .modal-overlay.show .modal {
      transform: scale(1);
    }
    .modal-title {
      font-weight: 300;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-size: 14px;
      color: #0f172a;
      margin-bottom: 16px;
    }
    .modal-text {
      font-weight: 300;
      font-size: 13px;
      line-height: 1.7;
      color: #64748b;
      margin-bottom: 24px;
    }
    .modal-buttons {
      display: flex;
      gap: 8px;
    }
    .modal-btn {
      flex: 1;
      padding: 12px 24px;
      border: 1px solid #cbd5e1;
      background: transparent;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 300;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-size: 10px;
      color: #475569;
    }
    .modal-btn:hover {
      background: #f8fafc;
    }
    .modal-btn-danger {
      background: #dc2626;
      color: white;
      border-color: #dc2626;
    }
    .modal-btn-danger:hover {
      background: #b91c1c;
    }
    .modal-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #cbd5e1;
      background: rgba(255,255,255,0.5);
      font-weight: 300;
      font-size: 14px;
      margin-bottom: 24px;
      font-family: inherit;
      line-height: 1.5;
    }
    .modal-input:focus {
      outline: none;
      border-color: #0f172a;
    }
    textarea.modal-input {
      resize: vertical;
      min-height: 120px;
    }
    
    .tabs {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      border: 1px solid #e2e8f0;
      padding: 4px;
      margin-bottom: 32px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
    }
    .tab {
      padding: 16px;
      border: none;
      background: transparent;
      color: #64748b;
      font-weight: 300;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-size: 12px;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }
    .tab:hover { background: #f8fafc; }
    .tab.active { background: #0f172a; color: white; }
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: #fbbf24;
    }
    .card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      border: 1px solid #e2e8f0;
      padding: 24px;
      margin-bottom: 24px;
      position: relative;
    }
    .card-title {
      font-weight: 300;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #cbd5e1;
      background: rgba(255,255,255,0.5);
      font-weight: 300;
      font-size: 14px;
    }
    .input:focus { outline: none; border-color: #0f172a; }
    .btn {
      padding: 12px 32px;
      border: none;
      background: #0f172a;
      color: white;
      font-weight: 300;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .btn:hover { background: #1e293b; }
    .btn-secondary {
      background: transparent;
      border: 1px solid #cbd5e1;
      color: #475569;
    }
    .btn-secondary:hover { background: #f8fafc; }
    .grid-input { display: grid; grid-template-columns: 1fr auto; gap: 8px; margin-bottom: 12px; }
    .category-header {
      padding: 16px;
      color: white;
      font-weight: 300;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .action-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .action-btn {
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: rgba(255,255,255,0.8);
      border: 1px solid #cbd5e1;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    .action-btn:hover { border-color: #0f172a; }
    .action-btn .emoji { font-size: 20px; margin-right: 12px; }
    .action-btn .name { font-weight: 300; color: #1e293b; }
    .action-btn .points { font-weight: 300; }
    .delete-btn {
      padding: 12px;
      border: 1px solid transparent;
      background: transparent;
      color: #94a3b8;
      cursor: pointer;
      transition: all 0.2s;
    }
    .delete-btn:hover { background: rgba(255,255,255,0.8); border-color: #e2e8f0; color: #dc2626; }
    .hidden { display: none !important; }
    .reward-card {
      border: 2px solid #e2e8f0;
      background: rgba(255,255,255,0.5);
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
    }
    .reward-card.unlockable { border-color: #fbbf24; background: rgba(254, 243, 199, 0.3); }
    .progress-bar {
      width: 100%;
      height: 4px;
      background: #e2e8f0;
      margin: 16px 0 8px;
      position: relative;
      overflow: hidden;
    }
    .progress-fill { height: 100%; background: #94a3b8; transition: width 0.3s; }
    .progress-fill.ready { background: #fbbf24; }
    .form-grid { display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 12px; }
    .emoji-input { width: 56px; text-align: center; font-size: 18px; }
    .points-input { width: 96px; }
    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: rgba(255,255,255,0.5);
      border: 1px solid #e2e8f0;
      margin-bottom: 8px;
    }
    .history-left { display: flex; align-items: center; gap: 12px; flex: 1; }
    .history-right { display: flex; align-items: center; gap: 12px; }
    .timestamp { font-size: 10px; color: #64748b; letter-spacing: 0.05em; text-transform: uppercase; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div id="confettiContainer"></div>
  
  <div id="loading">
    <div class="spinner"></div>
    <div class="loading-text">Loading</div>
  </div>

  <div id="app" class="container">
    <div class="header">
      <div class="header-content">
        <div>
          <div class="title">
            <span><strong>Habit</strong>at</span>
            <span class="logo-icon" id="logoIcon">
              <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 10 L85 30 L85 70 L50 90 L15 70 L15 30 Z" stroke="#0f172a" stroke-width="2.5" fill="none"/>
                <path d="M50 25 L75 40 L75 60 L50 75 L25 60 L25 40 Z" stroke="#0f172a" stroke-width="2.5" fill="none"/>
              </svg>
            </span>
          </div>
          <div class="subtitle">Cultivate positive momentum</div>
          <div class="greeting" style="font-size: 10px; color: #475569; letter-spacing: 0.1em; text-transform: uppercase; margin-top: 8px; font-weight: 400; line-height: 1.8;">
            Hi, <span id="userNameDisplay" onclick="startEditName()" style="cursor: pointer; border-bottom: 1px dotted #cbd5e1;" title="Click to edit name">Friend</span><input type="text" id="userNameInput" value="Friend" onblur="finishEditName()" onkeydown="if(event.key==='Enter') finishEditName(); if(event.key==='Escape') finishEditName()" style="display:none; background:transparent; border:none; border-bottom:1px solid #cbd5e1; color:#475569; padding:0; outline:none; font-size:10px; font-weight:400; letter-spacing:0.1em; text-transform:uppercase; width:100px">!
          </div>
          <div id="bonusBadge" style="display:none; margin-top:12px; padding:6px 12px; font-size:9px; font-weight:300; letter-spacing:0.1em; text-transform:uppercase; color:#0f172a; border:1px solid #f59e0b; background:#fbbf24; white-space: nowrap;"></div>
        </div>
        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 8px;">
          <div class="points-box">
            <div class="points-bg"></div>
            <div class="points-inner">
              <div class="points-value" id="totalPoints">0</div>
              <div class="points-label">Points</div>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 8px; align-self: flex-end;">
            <div class="settings-container">
              <div class="settings-icon" onclick="toggleSettings()">‚öô</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="settings-overlay" id="settingsOverlay" onclick="toggleSettings()"></div>
    <div class="settings-panel" id="settingsPanel">
      <div class="settings-header">
        <div class="settings-title">Settings</div>
        <button class="close-btn" onclick="toggleSettings()">√ó</button>
      </div>
      <div class="settings-content">
        <button onclick="toggleHelp()" class="settings-btn" id="helpBtn">
          <span class="emoji" id="helpIcon">‚ñº</span>
          <span>How to Use This App</span>
        </button>
        <div id="helpContent" class="help-content">
          <div class="help-section">
            <div class="help-title">Installing as Mobile App</div>
            <div class="help-text">For the best experience, add Habitat to your home screen. On Chrome (Android): Tap the three dots (‚ãÆ) at top right, then "Add to Home screen". On Safari (iPhone): Tap the Share button, scroll down and tap "Add to Home Screen". The app will open like a native app without browser bars.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Envisioning Your Future Self</div>
            <div class="help-text">The Vision tab helps you visualize who you want to become in 6 months. This gives context and meaning to the habits you're building‚Äîeach action becomes a step toward that future self. Note: The preset habits that come with the app are generic, so customize them to align with your personal vision. Add, remove, and rename categories and actions to match your unique goals.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Personalizing Your Habitat</div>
            <div class="help-text">Click on your name in the header (it says "Friend" by default) to customize it. Type your name and press Enter to save it.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Data Storage and Privacy</div>
            <div class="help-text">Your data is automatically saved to your browser on this device and remains completely private. All information is stored locally on your device only‚Äînothing is sent to any server or cloud. Your data does not sync across devices or browsers. To use Habitat on another device, export your data and import it on the other device. <span style="font-weight: 500; color: #334155;">Warning: Clearing your browser cache or data will erase all your progress. Export your data regularly as a backup.</span></div>
          </div>
          <div class="help-section">
            <div class="help-title">Earning Points</div>
            <div class="help-text">Tap any action button to log it and earn points. Use the "Log Steps" field to enter custom step counts (5 points per 2,000 steps).</div>
          </div>
          <div class="help-section">
            <div class="help-title">Customizing Categories</div>
            <div class="help-text">Click any category name (like "Workouts" or "Nutrition") to rename it. Click "+ Add" in any category to create custom actions with your own emoji, name, and point values. You can also add new categories using the "+ Add New Category" button at the bottom of the Earn tab, and delete custom categories using the trash icon in the category header.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Managing Rewards</div>
            <div class="help-text">In the Rewards tab, click "+ Add" to create custom rewards with an emoji, name, and point cost. When you have enough points, click "Redeem" to unlock a reward. Use "Undo" if you change your mind.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Deleting Items</div>
            <div class="help-text">Use the üóëÔ∏è button next to any action, reward, or history item to delete it. Note: deleting a history item will subtract those points from your total.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Spin the Logo for a Surprise</div>
            <div class="help-text">Tap or swipe the hexagon logo next to "HABITAT" for a surprise! You'll get either a motivational quote or a bonus.</div>
          </div>
          <div class="help-section">
            <div class="help-title">How Bonuses Work</div>
            <div class="help-text">When you spin the logo, you have about a 10% chance of receiving a bonus! Instant bonuses (+3 or +5 points) are added immediately. Multiplier bonuses (2x or 3x) activate for your next action only‚Äîa golden badge will appear below your name. Once you log an action with a multiplier, it's consumed and disappears. Important: If you delete an action that used a bonus, you won't get the bonus back‚Äîbonuses are one-time use only.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Export & Import Data</div>
            <div class="help-text">Export your data to save a backup as a JSON file. Import allows you to restore from a previously exported file. This is useful for transferring data between devices or keeping backups.</div>
          </div>
        </div>
        <button onclick="toggleAbout()" class="settings-btn" id="aboutBtn">
          <span class="emoji" id="aboutIcon">‚ñº</span>
          <span>Why HABITAT?</span>
        </button>
        <div id="aboutContent" class="help-content">
          <div class="help-section">
            <div class="help-title">Habit Accumulation Tracker</div>
            <div class="help-text">HABITAT stands for Habit Accumulation Tracker‚Äîa tool designed to help you build positive routines through consistent action and earned rewards.</div>
          </div>
          <div class="help-section">
            <div class="help-title">A Natural Environment for Growth</div>
            <div class="help-text">The name also alludes to the idea of a habitat being a natural environment. Rather than feeling forced, your habits are designed into your environment, making positive actions feel organic and sustainable.</div>
          </div>
          <div class="help-section">
            <div class="help-title">An Ecosystem of Positive Actions</div>
            <div class="help-text">HABITAT works twofold: it helps you both build habits and hold off on impulse decisions by positioning them as rewards that you earn permission for. This creates an ecosystem where every action contributes to your growth, and indulgences become intentional celebrations of your progress.</div>
          </div>
          <div class="help-section">
            <div class="help-title">Works with "No Zero Days"</div>
            <div class="help-text">HABITAT pairs perfectly with the "No Zero Days" approach to habit-building. Create actions for min, medium, and max levels of each habit and assign points accordingly. For example: "10 min workout" (5 pts), "30 min workout" (15 pts), "Full gym session" (25 pts). This way, doing something is always better than nothing, and you're rewarded proportionally for your effort.</div>
          </div>
        </div>
        <button onclick="exportData(); toggleSettings();" class="settings-btn">
          <span class="emoji">‚Üì</span>
          <span>Export Data</span>
        </button>
        <button onclick="importData(); toggleSettings();" class="settings-btn">
          <span class="emoji">‚Üë</span>
          <span>Import Data</span>
        </button>
        <button onclick="toggleStepsLogger()" class="settings-btn" id="stepsToggleBtn">
          <span class="emoji">‚óã</span>
          <span id="stepsToggleText">Hide Steps Logger</span>
        </button>
        <a href="/cdn-cgi/l/email-protection#6209070a22040710060d15040706004f010d" class="settings-btn" style="text-decoration: none; color: inherit;">
          <span class="emoji">‚úâ</span>
          <span>Give Feedback</span>
        </a>
        <button onclick="confirmReset()" class="settings-btn" style="border-color: #fca5a5; color: #991b1b;">
          <span class="emoji">‚ü≤</span>
          <span>Reset All Data</span>
        </button>
      </div>
      <div style="padding: 16px 24px; border-top: 1px solid #e2e8f0; font-size: 10px; color: #94a3b8; text-align: center; font-weight: 300; letter-spacing: 0.05em;">
        Designed by The Lumen Co.<br>All rights reserved.<br>Version 1.7
      </div>
    </div>

    <div class="modal-overlay" id="resetModal">
      <div class="modal">
        <div class="modal-title">Reset All Data?</div>
        <div class="modal-text">This will permanently delete all your points, history, custom actions, and rewards. This action cannot be undone. Consider exporting your data first as a backup.</div>
        <div class="modal-buttons">
          <button class="modal-btn" onclick="closeResetModal()">Cancel</button>
          <button class="modal-btn modal-btn-danger" onclick="resetAllData()">Reset</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="addCategoryModal">
      <div class="modal">
        <div class="modal-title">Add New Category</div>
        <div class="modal-text">Enter a name for your new category:</div>
        <input type="text" id="newCategoryName" class="modal-input" placeholder="Category name">
        <div class="modal-buttons">
          <button class="modal-btn" onclick="closeAddCategoryModal()">Cancel</button>
          <button class="modal-btn modal-btn-danger" onclick="confirmAddCategory()" style="background:#0f172a;border-color:#0f172a">Create</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="deleteCategoryModal">
      <div class="modal">
        <div class="modal-title">Delete Category?</div>
        <div class="modal-text" id="deleteCategoryText">This will permanently delete this category and all actions in it. This action cannot be undone.</div>
        <div class="modal-buttons">
          <button class="modal-btn" onclick="closeDeleteCategoryModal()">Cancel</button>
          <button class="modal-btn modal-btn-danger" onclick="executeDeleteCategory()">Delete</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="quoteModal">
      <div class="modal">
        <div class="modal-text" id="quoteText" style="font-size: 18px; line-height: 1.8; font-style: normal; margin-bottom: 16px; text-align: center; font-weight: 300;"></div>
        <div style="text-align: center; font-size: 11px; color: #64748b; font-weight: 300; margin-bottom: 24px; letter-spacing: 0.1em; text-transform: uppercase;" id="quoteAuthor"></div>
        <div class="modal-buttons">
          <button class="modal-btn" onclick="closeQuoteModal()" style="background:#0f172a;border-color:#0f172a;color:white;width:100%" id="quoteAcknowledgeBtn">Hell Yeah!</button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="onboardingModal" style="z-index: 20000;">
      <div class="modal" style="max-width: 600px;">
        <div class="modal-title" style="font-size: 18px; margin-bottom: 8px;">‚ú® Your Future Self</div>
        <div style="text-align: center; font-size: 12px; color: #64748b; margin-bottom: 24px; font-weight: 300;">Envision who you'll become in 6 months</div>
        <div id="onboardingContent"></div>
        <div class="modal-buttons" style="margin-top: 24px;">
          <button class="modal-btn" onclick="skipOnboarding()" style="flex: 1;">Skip for Now</button>
          <button class="modal-btn" onclick="nextOnboardingQuestion()" style="background:#0f172a;border-color:#0f172a;color:white;flex: 2;" id="onboardingNextBtn">Next</button>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchView('earn')" id="tab-earn">Earn</button>
      <button class="tab" onclick="switchView('rewards')" id="tab-rewards">Rewards</button>
      <button class="tab" onclick="switchView('history')" id="tab-history">History</button>
      <button class="tab" onclick="switchView('vision')" id="tab-vision">Vision</button>
    </div>

    <div id="earnView"></div>
    <div id="rewardsView" class="hidden"></div>
    <div id="historyView" class="hidden"></div>
    <div id="visionView" class="hidden"></div>
  </div>

  <script>
    let state = {
      totalPoints: 0,
      history: [],
      userName: 'Friend',
      showStepsLogger: true,
      categoryOrder: ['workouts', 'steps', 'nutrition', 'hydration', 'selfcare'],
      activeBonus: null,
      futureVision: {
        completed: false,
        lastUpdated: null,
        q1: '', // What does your ideal day look like six months from now?
        q2: '', // How do you carry yourself? How do you feel on the inside?
        q3: '', // What habits define your future self?
        q4: '', // How do you look? What's your physical presence?
        q5: ''  // What are you most proud of about who you've become?
      },
      rewards: [
        { id: 1, name: 'New Pair of Shoes', cost: 500, icon: 'üëü', redeemed: false },
        { id: 2, name: 'Spa Day', cost: 250, icon: 'üíÜ', redeemed: false },
        { id: 3, name: 'New Workout Gear', cost: 150, icon: 'üëï', redeemed: false }
      ],
      actions: {
        workouts: [
          { id: 1, name: '45 min Gym Session', points: 20, emoji: 'üèãÔ∏è' },
          { id: 2, name: 'Yoga Studio Class', points: 15, emoji: 'üßò' },
          { id: 3, name: '30 min Run', points: 18, emoji: 'üèÉ' }
        ],
        steps: [
          { id: 1, name: '2,000 steps', points: 5, emoji: 'üëü' },
          { id: 2, name: '5,000 steps', points: 12, emoji: 'üö∂' },
          { id: 3, name: '10,000 steps', points: 25, emoji: 'üéØ' }
        ],
        nutrition: [
          { id: 1, name: 'High Protein Meal', points: 15, emoji: 'ü•©' },
          { id: 2, name: 'Healthy Breakfast', points: 10, emoji: 'ü•£' },
          { id: 3, name: 'Salad/Vegetables', points: 8, emoji: 'ü•ó' }
        ],
        hydration: [
          { id: 1, name: '2 bottles of water', points: 10, emoji: 'üíß' },
          { id: 2, name: '4 bottles of water', points: 20, emoji: 'üí¶' },
          { id: 3, name: '8 glasses of water', points: 15, emoji: 'üö∞' }
        ],
        selfcare: [
          { id: 1, name: 'Face mask', points: 5, emoji: 'üßñ' },
          { id: 2, name: 'Meditation', points: 10, emoji: 'üßò‚Äç‚ôÄÔ∏è' },
          { id: 3, name: 'Spent time in nature', points: 15, emoji: 'üå≥' }
        ]
      },
      categoryNames: {
        workouts: 'Workouts',
        steps: 'Steps',
        nutrition: 'Nutrition',
        hydration: 'Hydration',
        selfcare: 'Self Care'
      }
    };

    const colors = {
      workouts: { bg: '#3b0764', border: '#e9d5ff' },
      steps: { bg: 'linear-gradient(to right, #1e3a8a, #312e81)', border: '#93c5fd' },
      nutrition: { bg: 'linear-gradient(to right, #065f46, #134e4a)', border: '#6ee7b7' },
      hydration: { bg: 'linear-gradient(to right, #155e75, #075985)', border: '#67e8f9' },
      selfcare: { bg: 'linear-gradient(to right, #881337, #831843)', border: '#fda4af' }
    };

    const colorRotation = [
      { bg: '#3b0764', border: '#e9d5ff' },
      { bg: 'linear-gradient(to right, #1e3a8a, #312e81)', border: '#93c5fd' },
      { bg: 'linear-gradient(to right, #065f46, #134e4a)', border: '#6ee7b7' },
      { bg: 'linear-gradient(to right, #155e75, #075985)', border: '#67e8f9' },
      { bg: 'linear-gradient(to right, #881337, #831843)', border: '#fda4af' }
    ];

    function getCategoryColor(index) {
      return colorRotation[index % colorRotation.length];
    }

    function toggleSettings() {
      const overlay = document.getElementById('settingsOverlay');
      const panel = document.getElementById('settingsPanel');
      overlay.classList.toggle('open');
      panel.classList.toggle('open');
    }

    function toggleHelp() {
      const helpContent = document.getElementById('helpContent');
      const helpIcon = document.getElementById('helpIcon');
      helpContent.classList.toggle('show');
      
      if (helpContent.classList.contains('show')) {
        helpIcon.textContent = '‚ñ≤';
      } else {
        helpIcon.textContent = '‚ñº';
      }
    }

    function toggleAbout() {
      const aboutContent = document.getElementById('aboutContent');
      const aboutIcon = document.getElementById('aboutIcon');
      aboutContent.classList.toggle('show');
      
      if (aboutContent.classList.contains('show')) {
        aboutIcon.textContent = '‚ñ≤';
      } else {
        aboutIcon.textContent = '‚ñº';
      }
    }

    function toggleStepsLogger() {
      state.showStepsLogger = !state.showStepsLogger;
      saveData();
      renderEarn();
      updateStepsToggleButton();
    }

    function updateStepsToggleButton() {
      const text = document.getElementById('stepsToggleText');
      if (text) {
        text.textContent = state.showStepsLogger ? 'Hide Steps Logger' : 'Show Steps Logger';
      }
    }

    function addNewCategory() {
      document.getElementById('newCategoryName').value = '';
      document.getElementById('addCategoryModal').classList.add('show');
      setTimeout(() => document.getElementById('newCategoryName').focus(), 100);
    }
    
    window.addNewCategory = addNewCategory;

    function closeAddCategoryModal() {
      document.getElementById('addCategoryModal').classList.remove('show');
    }

    function confirmAddCategory() {
      const categoryName = document.getElementById('newCategoryName').value.trim();
      if (!categoryName) {
        alert('Please enter a category name.');
        return;
      }
      
      const categoryId = 'custom_' + Date.now();
      
      state.categoryOrder.push(categoryId);
      state.actions[categoryId] = [];
      state.categoryNames[categoryId] = categoryName;
      
      saveData();
      closeAddCategoryModal();
      renderEarn();
    }

    function deleteCategory(categoryId) {
      // Don't allow deleting if it's the last category
      if (state.categoryOrder.length <= 1) {
        alert('You must have at least one category.');
        return;
      }
      
      // Remove from order
      state.categoryOrder = state.categoryOrder.filter(id => id !== categoryId);
      
      // Remove actions and category name
      delete state.actions[categoryId];
      delete state.categoryNames[categoryId];
      
      saveData();
      renderEarn();
    }
    
    window.deleteCategory = deleteCategory;

    let categoryToDelete = null;

    function confirmDeleteCategory(categoryId) {
      const categoryName = state.categoryNames[categoryId] || categoryId;
      document.getElementById('deleteCategoryText').textContent = `Delete "${categoryName}"? This will permanently delete this category and all actions in it. This action cannot be undone.`;
      categoryToDelete = categoryId;
      document.getElementById('deleteCategoryModal').classList.add('show');
    }

    function closeDeleteCategoryModal() {
      document.getElementById('deleteCategoryModal').classList.remove('show');
      categoryToDelete = null;
    }

    function executeDeleteCategory() {
      if (categoryToDelete) {
        deleteCategory(categoryToDelete);
        closeDeleteCategoryModal();
      }
    }

    const motivationalQuotes = [
      { quote: "Every action you take is a vote for the type of person you wish to become.", author: "James Clear", type: "quote" },
      { quote: "You do not rise to the level of your goals. You fall to the level of your systems.", author: "James Clear", type: "quote" },
      { quote: "Habits are the compound interest of self-improvement.", author: "James Clear", type: "quote" },
      { quote: "The secret to getting results that last is to never stop making improvements.", author: "James Clear", type: "quote" },
      { quote: "Success is the product of daily habits‚Äînot once-in-a-lifetime transformations.", author: "James Clear", type: "quote" },
      { quote: "Make it so easy you can't say no.", author: "BJ Fogg", type: "quote" },
      { quote: "Motivation is what gets you started. Habit is what keeps you going.", author: "Jim Ryun", type: "quote" },
      { quote: "You are what you repeatedly do. Excellence is not an act, but a habit.", author: "Aristotle", type: "quote" },
      { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs", type: "quote" },
      { quote: "Progress, not perfection.", author: "Unknown", type: "quote" },
      { quote: "Don't count the days, make the days count.", author: "Muhammad Ali", type: "quote" },
      { quote: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb", type: "quote" },
      { quote: "Discipline is choosing between what you want now and what you want most.", author: "Unknown", type: "quote" },
      { quote: "Small daily improvements are the key to staggering long-term results.", author: "Unknown", type: "quote" },
      { quote: "The secret of getting ahead is getting started.", author: "Mark Twain", type: "quote" },
      { quote: "It's not about having time. It's about making time.", author: "Unknown", type: "quote" },
      { quote: "The only impossible journey is the one you never begin.", author: "Tony Robbins", type: "quote" },
      { quote: "Fall seven times, stand up eight.", author: "Japanese Proverb", type: "quote" },
      { quote: "Transformation happens one choice at a time.", author: "Unknown", type: "quote" },
      { quote: "Your future self will thank you for the good habits you build today.", author: "Unknown", type: "quote" },
      { quote: "Be stronger than your excuses.", author: "Unknown", type: "quote" },
      { quote: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu", type: "quote" },
      { quote: "Consistency is the true foundation of trust.", author: "Roy T. Bennett", type: "quote" },
      { quote: "Action is the foundational key to all success.", author: "Pablo Picasso", type: "quote" },
      { quote: "What you do today can improve all your tomorrows.", author: "Ralph Marston", type: "quote" },
      { quote: "The future depends on what you do today.", author: "Mahatma Gandhi", type: "quote" },
      { quote: "Good habits are worth being fanatical about.", author: "John Irving", type: "quote" },
      { quote: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.", author: "Will Durant", type: "quote" },
      { quote: "Change might not be fast and it isn't always easy. But with time and effort, almost any habit can be reshaped.", author: "Charles Duhigg", type: "quote" },
      { quote: "First forget inspiration. Habit is more dependable.", author: "Octavia Butler", type: "quote" },
      { quote: "You'll never change your life until you change something you do daily.", author: "John C. Maxwell", type: "quote" },
      { quote: "The difference between who you are and who you want to be is what you do.", author: "Unknown", type: "quote" },
      { quote: "A small daily task, if it be really daily, will beat the labours of a spasmodic Hercules.", author: "Anthony Trollope", type: "quote" },
      { quote: "We first make our habits, and then our habits make us.", author: "John Dryden", type: "quote" },
      { quote: "Depending on what they are, our habits will either make us or break us.", author: "Denis Waitley", type: "quote" },
      { quote: "The chains of habit are too weak to be felt until they are too strong to be broken.", author: "Samuel Johnson", type: "quote" },
      // Bonuses (10% of total - 4 bonuses, 36 quotes = 40 total)
      { quote: "Bonus activated! Your next action is worth DOUBLE points!", author: "Bonus Round", type: "bonus", bonusType: "multiplier", bonusValue: 2 },
      { quote: "Triple threat! Your next action is worth 3X points!", author: "Bonus Round", type: "bonus", bonusType: "multiplier", bonusValue: 3 },
      { quote: "Instant reward! You just earned 5 bonus points!", author: "Bonus Round", type: "bonus", bonusType: "instant", bonusValue: 5 },
      { quote: "Lucky spin! You just earned 3 bonus points!", author: "Bonus Round", type: "bonus", bonusType: "instant", bonusValue: 3 }
    ];

    const acknowledgements = ["Hell Yeah!", "Love It!", "Let's Go!", "I'm In!", "Absolutely!", "You Bet!"];

    const onboardingQuestions = [
      { key: 'q1', question: 'What does your ideal day look like six months from now?', placeholder: 'Describe your perfect day...' },
      { key: 'q2', question: 'How do you carry yourself? How do you feel on the inside?', placeholder: 'Your confidence, energy, emotions...' },
      { key: 'q3', question: 'What habits define your future self?', placeholder: 'Your daily routines and practices...' },
      { key: 'q4', question: 'How do you look? What\'s your physical presence like?', placeholder: 'Your appearance, health, vitality...' },
      { key: 'q5', question: 'What are you most proud of about who you\'ve become?', placeholder: 'Your biggest achievement or transformation...' }
    ];

    let currentOnboardingQuestion = 0;

    function showOnboarding() {
      // Only show automatically if not completed
      if (state.futureVision.completed) {
        console.log('Onboarding already completed, skipping auto-show');
        return;
      }
      console.log('showOnboarding called, completed:', state.futureVision.completed);
      currentOnboardingQuestion = 0;
      renderOnboardingQuestion();
      const modal = document.getElementById('onboardingModal');
      console.log('Modal element:', modal);
      if (modal) {
        modal.classList.add('show');
        console.log('Modal classes:', modal.className);
      }
    }

    function forceShowOnboarding() {
      // This version always shows, used by "Edit Your Vision" button
      currentOnboardingQuestion = 0;
      renderOnboardingQuestion();
      const modal = document.getElementById('onboardingModal');
      if (modal) {
        modal.classList.add('show');
      }
    }

    function renderOnboardingQuestion() {
      const q = onboardingQuestions[currentOnboardingQuestion];
      const content = document.getElementById('onboardingContent');
      const progress = ((currentOnboardingQuestion + 1) / onboardingQuestions.length * 100).toFixed(0);
      
      content.innerHTML = `
        <div style="margin-bottom: 16px;">
          <div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px;">Question ${currentOnboardingQuestion + 1} of ${onboardingQuestions.length}</div>
          <div style="height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden;">
            <div style="height: 100%; background: #0f172a; width: ${progress}%; transition: width 0.3s;"></div>
          </div>
        </div>
        <div style="font-size: 15px; font-weight: 300; margin-bottom: 16px; line-height: 1.6;">${q.question}</div>
        <textarea id="onboardingAnswer" class="modal-input" placeholder="${q.placeholder}" style="min-height: 120px; resize: vertical; font-family: inherit;">${state.futureVision[q.key] || ''}</textarea>
      `;
      
      document.getElementById('onboardingNextBtn').textContent = currentOnboardingQuestion === onboardingQuestions.length - 1 ? 'Complete' : 'Next';
      setTimeout(() => document.getElementById('onboardingAnswer').focus(), 100);
    }

    function nextOnboardingQuestion() {
      const answer = document.getElementById('onboardingAnswer').value.trim();
      const q = onboardingQuestions[currentOnboardingQuestion];
      
      state.futureVision[q.key] = answer;
      
      if (currentOnboardingQuestion < onboardingQuestions.length - 1) {
        currentOnboardingQuestion++;
        renderOnboardingQuestion();
      } else {
        completeOnboarding();
      }
    }

    function completeOnboarding() {
      state.futureVision.completed = true;
      state.futureVision.lastUpdated = new Date().toLocaleString();
      saveData();
      document.getElementById('onboardingModal').classList.remove('show');
    }

    function skipOnboarding() {
      state.futureVision.completed = true;
      saveData();
      document.getElementById('onboardingModal').classList.remove('show');
    }

    window.showOnboarding = showOnboarding;
    window.forceShowOnboarding = forceShowOnboarding;
    window.nextOnboardingQuestion = nextOnboardingQuestion;
    window.skipOnboarding = skipOnboarding;

    function showRandomQuote() {
      const randomQuoteObj = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
      const randomAck = acknowledgements[Math.floor(Math.random() * acknowledgements.length)];
      
      // Handle display differently for bonuses vs quotes
      if (randomQuoteObj.type === 'bonus') {
        document.getElementById('quoteText').textContent = randomQuoteObj.quote;
        document.getElementById('quoteAuthor').textContent = '';
        document.getElementById('quoteAuthor').style.display = 'none';
      } else {
        document.getElementById('quoteText').textContent = '"' + randomQuoteObj.quote + '"';
        document.getElementById('quoteAuthor').textContent = '‚Äî ' + randomQuoteObj.author;
        document.getElementById('quoteAuthor').style.display = 'block';
      }
      
      document.getElementById('quoteAcknowledgeBtn').textContent = randomAck;
      
      // Handle bonuses
      if (randomQuoteObj.type === 'bonus') {
        if (randomQuoteObj.bonusType === 'instant') {
          // Apply instant bonus immediately
          state.totalPoints += randomQuoteObj.bonusValue;
          state.history.unshift({
            name: 'Bonus Points',
            points: randomQuoteObj.bonusValue,
            emoji: 'üéÅ',
            category: 'bonus',
            timestamp: new Date().toLocaleString()
          });
          saveData();
          updatePoints();
        } else if (randomQuoteObj.bonusType === 'multiplier') {
          // Set active multiplier
          state.activeBonus = {
            type: 'multiplier',
            value: randomQuoteObj.bonusValue
          };
          saveData();
          updateBonusBadge();
        }
      }
      
      document.getElementById('quoteModal').classList.add('show');
    }

    function closeQuoteModal() {
      document.getElementById('quoteModal').classList.remove('show');
    }

    function updateBonusBadge() {
      const badge = document.getElementById('bonusBadge');
      if (!badge) return;
      
      if (state.activeBonus && state.activeBonus.type === 'multiplier') {
        badge.textContent = state.activeBonus.value + 'x Bonus Active';
        badge.style.display = 'block';
      } else {
        badge.style.display = 'none';
      }
    }

    function initLogoSpinner() {
      const logo = document.getElementById('logoIcon');
      if (!logo) return;
      
      let startX = 0;
      let startY = 0;
      let startTime = 0;
      let isSwiping = false;
      
      // Gentle auto-spin every 5 seconds
      setInterval(() => {
        // Don't auto-spin if already spinning
        if (logo.classList.contains('spinning-cw') || logo.classList.contains('spinning-ccw') || logo.classList.contains('gentle-spin')) {
          return;
        }
        logo.classList.add('gentle-spin');
        setTimeout(() => {
          logo.classList.remove('gentle-spin');
        }, 2000);
      }, 5000);
      
      logo.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        startTime = Date.now();
        isSwiping = true;
      }, { passive: true });
      
      logo.addEventListener('touchmove', (e) => {
        if (!isSwiping) return;
        e.preventDefault();
      }, { passive: false });
      
      logo.addEventListener('touchend', (e) => {
        if (!isSwiping) return;
        
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;
        const endTime = Date.now();
        
        const deltaX = endX - startX;
        const deltaY = endY - startY;
        const deltaTime = endTime - startTime;
        
        // Check if it's a tap (very small movement, quick)
        const isTap = Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10 && deltaTime < 300;
        
        if (isTap) {
          // Random direction for tap
          const randomDirection = Math.random() > 0.5 ? 'cw' : 'ccw';
          logo.classList.remove('spinning-cw', 'spinning-ccw');
          logo.classList.add('spinning-' + randomDirection);
          
          setTimeout(() => {
            logo.classList.remove('spinning-cw', 'spinning-ccw');
            showRandomQuote();
          }, 3000);
        } else if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {
          // Determine if horizontal swipe is more significant
          // Remove any existing spinning classes
          logo.classList.remove('spinning-cw', 'spinning-ccw');
          
          // Determine direction based on swipe
          if (deltaX > 0) {
            // Swipe right = clockwise
            logo.classList.add('spinning-cw');
          } else {
            // Swipe left = counter-clockwise
            logo.classList.add('spinning-ccw');
          }
          
          // Remove class and show quote after animation
          setTimeout(() => {
            logo.classList.remove('spinning-cw', 'spinning-ccw');
            showRandomQuote();
          }, 3000);
        }
        
        isSwiping = false;
      }, { passive: true });
      
      // Also support mouse for desktop
      let mouseDown = false;
      let mouseStartX = 0;
      let mouseStartTime = 0;
      
      logo.addEventListener('mousedown', (e) => {
        mouseDown = true;
        mouseStartX = e.clientX;
        mouseStartTime = Date.now();
      });
      
      document.addEventListener('mouseup', (e) => {
        if (!mouseDown) return;
        
        const deltaX = e.clientX - mouseStartX;
        const deltaTime = Date.now() - mouseStartTime;
        
        // Check if it's a click (very small movement)
        const isClick = Math.abs(deltaX) < 10 && deltaTime < 300;
        
        if (isClick) {
          // Random direction for click
          const randomDirection = Math.random() > 0.5 ? 'cw' : 'ccw';
          logo.classList.remove('spinning-cw', 'spinning-ccw');
          logo.classList.add('spinning-' + randomDirection);
          
          setTimeout(() => {
            logo.classList.remove('spinning-cw', 'spinning-ccw');
            showRandomQuote();
          }, 3000);
        } else if (Math.abs(deltaX) > 10) {
          logo.classList.remove('spinning-cw', 'spinning-ccw');
          
          if (deltaX > 0) {
            logo.classList.add('spinning-cw');
          } else {
            logo.classList.add('spinning-ccw');
          }
          
          setTimeout(() => {
            logo.classList.remove('spinning-cw', 'spinning-ccw');
            showRandomQuote();
          }, 3000);
        }
        
        mouseDown = false;
      });
    }

    function editGreeting() {
      const currentName = state.userName || 'Friend';
      const newName = prompt('What should we call you?', currentName);
      if (newName !== null && newName.trim() !== '') {
        state.userName = newName.trim();
        document.getElementById('userName').textContent = state.userName;
        saveData();
      }
    }

    // Make function globally accessible
    window.editGreeting = editGreeting;

    function confirmReset() {
      document.getElementById('resetModal').classList.add('show');
    }

    function closeResetModal() {
      document.getElementById('resetModal').classList.remove('show');
    }

    function resetAllData() {
      const originalState = {
        totalPoints: 0,
        history: [],
        userName: 'Friend',
        showStepsLogger: true,
        categoryOrder: ['workouts', 'steps', 'nutrition', 'hydration', 'selfcare'],
        activeBonus: null,
        futureVision: {
          completed: false,
          lastUpdated: null,
          q1: '',
          q2: '',
          q3: '',
          q4: '',
          q5: ''
        },
        rewards: [
          { id: 1, name: 'New Pair of Shoes', cost: 500, icon: 'üëü', redeemed: false },
          { id: 2, name: 'Spa Day', cost: 250, icon: 'üíÜ', redeemed: false },
          { id: 3, name: 'New Workout Gear', cost: 150, icon: 'üëï', redeemed: false }
        ],
        actions: {
          workouts: [
            { id: 1, name: '45 min Gym Session', points: 20, emoji: 'üèãÔ∏è' },
            { id: 2, name: 'Yoga Studio Class', points: 15, emoji: 'üßò' },
            { id: 3, name: '30 min Run', points: 18, emoji: 'üèÉ' }
          ],
          steps: [
            { id: 1, name: '2,000 steps', points: 5, emoji: 'üëü' },
            { id: 2, name: '5,000 steps', points: 12, emoji: 'üö∂' },
            { id: 3, name: '10,000 steps', points: 25, emoji: 'üéØ' }
          ],
          nutrition: [
            { id: 1, name: 'High Protein Meal', points: 15, emoji: 'ü•©' },
            { id: 2, name: 'Healthy Breakfast', points: 10, emoji: 'ü•£' },
            { id: 3, name: 'Salad/Vegetables', points: 8, emoji: 'ü•ó' }
          ],
          hydration: [
            { id: 1, name: '2 bottles of water', points: 10, emoji: 'üíß' },
            { id: 2, name: '4 bottles of water', points: 20, emoji: 'üí¶' },
            { id: 3, name: '8 glasses of water', points: 15, emoji: 'üö∞' }
          ],
          selfcare: [
            { id: 1, name: 'Face mask', points: 5, emoji: 'üßñ' },
            { id: 2, name: 'Meditation', points: 10, emoji: 'üßò‚Äç‚ôÄÔ∏è' },
            { id: 3, name: 'Spent time in nature', points: 15, emoji: 'üå≥' }
          ]
        },
        categoryNames: {
          workouts: 'Workouts',
          steps: 'Steps',
          nutrition: 'Nutrition',
          hydration: 'Hydration',
          selfcare: 'Self Care'
        }
      };
      
      state = originalState;
      saveData();
      updatePoints();
      closeResetModal();
      toggleSettings();
      renderEarn();
    }

    function loadData() {
      try {
        const saved = localStorage.getItem('habitat-data');
        if (saved) state = { ...state, ...JSON.parse(saved) };
      } catch (e) {}
      
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').classList.add('loaded');
        render();
      }, 800);
    }

    function saveData() {
      try {
        localStorage.setItem('habitat-data', JSON.stringify(state));
      } catch (e) {}
    }

    function updatePoints() {
      document.getElementById('totalPoints').textContent = state.totalPoints;
    }

    function logAction(actionId, category, event) {
      const action = state.actions[category].find(a => a.id === actionId);
      if (!action) return;
      
      // Show celebration at click location
      if (event) {
        showCelebration(event.clientX, event.clientY);
      }
      
      let pointsToAdd = action.points;
      let bonusText = '';
      
      // Apply multiplier if active
      if (state.activeBonus && state.activeBonus.type === 'multiplier') {
        pointsToAdd = action.points * state.activeBonus.value;
        bonusText = ' (' + state.activeBonus.value + 'x bonus)';
        state.activeBonus = null; // Clear bonus after use
      }
      
      state.totalPoints += pointsToAdd;
      state.history.unshift({ 
        ...action, 
        category, 
        points: pointsToAdd,
        originalPoints: action.points,
        bonusText: bonusText,
        timestamp: new Date().toLocaleString() 
      });
      if (state.history.length > 20) state.history.pop();
      saveData();
      updatePoints();
      updateBonusBadge();
    }

    function logCustomSteps() {
      const steps = parseInt(document.getElementById('customSteps').value);
      if (steps > 0) {
        const points = Math.floor(steps / 2000) * 5;
        if (points > 0) {
          state.totalPoints += points;
          state.history.unshift({
            name: steps.toLocaleString() + ' steps',
            points,
            emoji: 'üëü',
            category: 'steps',
            timestamp: new Date().toLocaleString()
          });
          if (state.history.length > 20) state.history.pop();
          saveData();
          updatePoints();
        }
        document.getElementById('customSteps').value = '';
        document.getElementById('stepsPreview').textContent = '';
      }
    }

    function updateStepsPreview() {
      const steps = parseInt(document.getElementById('customSteps').value);
      const preview = document.getElementById('stepsPreview');
      if (steps > 0) {
        preview.textContent = '= ' + Math.floor(steps / 2000) * 5 + ' points';
      } else {
        preview.textContent = '';
      }
    }

    function addPreset(category) {
      const emoji = document.getElementById('emoji-' + category).value || '‚≠ê';
      const name = document.getElementById('name-' + category).value;
      const points = parseInt(document.getElementById('points-' + category).value);
      if (name && points) {
        state.actions[category].push({ id: Date.now(), name, points, emoji });
        saveData();
        renderEarn();
      }
    }

    function deletePreset(category, id) {
      state.actions[category] = state.actions[category].filter(a => a.id !== id);
      saveData();
      renderEarn();
    }

    function toggleAddForm(category) {
      document.getElementById('addForm-' + category).classList.toggle('hidden');
    }

    function startRenameCategory(category) {
      const span = document.getElementById('catName-' + category);
      const input = document.getElementById('catInput-' + category);
      span.style.display = 'none';
      input.style.display = 'inline-block';
      input.focus();
    }

    function finishRenameCategory(category) {
      const span = document.getElementById('catName-' + category);
      const input = document.getElementById('catInput-' + category);
      const newName = input.value.trim();
      if (newName) {
        state.categoryNames[category] = newName;
        span.textContent = newName;
        saveData();
      }
      input.style.display = 'none';
      span.style.display = 'inline';
    }

    function startEditName() {
      const span = document.getElementById('userNameDisplay');
      const input = document.getElementById('userNameInput');
      span.style.display = 'none';
      input.style.display = 'inline';
      input.focus();
      input.select();
    }

    function finishEditName() {
      const span = document.getElementById('userNameDisplay');
      const input = document.getElementById('userNameInput');
      const newName = input.value.trim();
      if (newName) {
        state.userName = newName;
        span.textContent = newName;
        saveData();
      }
      input.style.display = 'none';
      span.style.display = 'inline';
    }

    function deleteHistoryItem(index) {
      state.totalPoints -= state.history[index].points;
      state.history.splice(index, 1);
      saveData();
      updatePoints();
      renderHistory();
    }

    function addReward() {
      const icon = document.getElementById('rewardIcon').value || 'üéÅ';
      const name = document.getElementById('rewardName').value;
      const cost = parseInt(document.getElementById('rewardCost').value);
      if (name && cost) {
        state.rewards.push({ id: Date.now(), name, cost, icon, redeemed: false });
        document.getElementById('rewardIcon').value = 'üéÅ';
        document.getElementById('rewardName').value = '';
        document.getElementById('rewardCost').value = '';
        document.getElementById('addRewardForm').classList.add('hidden');
        saveData();
        renderRewards();
      }
    }

    function deleteReward(id) {
      state.rewards = state.rewards.filter(r => r.id !== id);
      saveData();
      renderRewards();
    }

    function redeemReward(id) {
      const reward = state.rewards.find(r => r.id === id);
      if (reward && state.totalPoints >= reward.cost && !reward.redeemed) {
        showConfetti();
        state.totalPoints -= reward.cost;
        reward.redeemed = true;
        saveData();
        updatePoints();
        setTimeout(() => renderRewards(), 100);
      }
    }

    function undoReward(id) {
      const reward = state.rewards.find(r => r.id === id);
      if (reward && reward.redeemed) {
        state.totalPoints += reward.cost;
        reward.redeemed = false;
        saveData();
        updatePoints();
        renderRewards();
      }
    }

    function showConfetti() {
      const container = document.getElementById('confettiContainer');
      const colors = ['#fbbf24', '#0f172a', '#94a3b8', '#e2e8f0'];
      
      for (let i = 0; i < 30; i++) {
        const confetto = document.createElement('div');
        confetto.className = 'confetti square';
        confetto.style.left = Math.random() * 100 + '%';
        confetto.style.top = '-10px';
        confetto.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetto.style.animation = `confettiFall ${2 + Math.random() * 2}s ease-in forwards`;
        confetto.style.animationDelay = Math.random() * 0.3 + 's';
        container.appendChild(confetto);
        
        setTimeout(() => confetto.remove(), 4500);
      }
    }

    function showCelebration(x, y) {
      const messages = ['Nice!', 'Great Job!', 'Well Done!', '‚úì', 'Keep Going!', 'Amazing!'];
      const message = messages[Math.floor(Math.random() * messages.length)];
      
      const element = document.createElement('div');
      element.className = 'celebration-message';
      element.textContent = message;
      element.style.left = x + 'px';
      element.style.top = y + 'px';
      
      document.body.appendChild(element);
      
      setTimeout(() => element.remove(), 1000);
    }

    function exportData() {
      const dataStr = JSON.stringify(state, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'habitat-backup-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      URL.revokeObjectURL(url);
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const imported = JSON.parse(event.target.result);
              state = imported;
              saveData();
              updatePoints();
              alert('Data imported successfully!');
              if (state.currentView) switchView(state.currentView);
              else renderEarn();
            } catch (error) {
              alert('Error importing file. Please make sure it\'s a valid Habitat backup file.');
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }

    function switchView(view) {
      ['earn', 'rewards', 'history', 'vision'].forEach(v => {
        document.getElementById('tab-' + v).classList.remove('active');
        document.getElementById(v + 'View').classList.add('hidden');
      });
      document.getElementById('tab-' + view).classList.add('active');
      document.getElementById(view + 'View').classList.remove('hidden');
      if (view === 'earn') renderEarn();
      else if (view === 'rewards') renderRewards();
      else if (view === 'history') renderHistory();
      else if (view === 'vision') renderVision();
    }

    function renderEarn() {
      const container = document.getElementById('earnView');
      let html = '';
      
      if (state.showStepsLogger) {
        html += '<div class="card"><h3 class="card-title">Log Steps</h3><div class="grid-input"><input type="number" id="customSteps" oninput="updateStepsPreview()" placeholder="Enter steps" class="input"><button onclick="logCustomSteps()" class="btn">Log</button></div><p id="stepsPreview" style="font-size:12px;color:#64748b"></p></div>';
      }

      state.categoryOrder.forEach((categoryId, index) => {
        const items = state.actions[categoryId] || [];
        const categoryName = state.categoryNames[categoryId] || categoryId;
        const color = colors[categoryId] || getCategoryColor(index);
        const isCustom = categoryId.startsWith('custom_');
        
        html += '<div class="card" style="padding:0;overflow:hidden"><div class="category-header" style="background:' + color.bg + '"><span id="catName-' + categoryId + '" onclick="startRenameCategory(\'' + categoryId + '\')" style="cursor:pointer" title="Click to rename">' + categoryName + '</span><input type="text" id="catInput-' + categoryId + '" value="' + categoryName + '" onblur="finishRenameCategory(\'' + categoryId + '\')" onkeydown="if(event.key===\'Enter\') finishRenameCategory(\'' + categoryId + '\'); if(event.key===\'Escape\') finishRenameCategory(\'' + categoryId + '\')" style="display:none;background:rgba(255,255,255,0.2);border:none;border-bottom:1px solid rgba(255,255,255,0.4);color:white;padding:4px 8px;outline:none"><div style="display:flex;gap:8px;align-items:center">' + (isCustom ? '<button onclick="confirmDeleteCategory(\'' + categoryId + '\')" style="background:transparent;border:none;color:rgba(255,255,255,0.6);cursor:pointer;font-size:14px;padding:4px 8px;transition:all 0.2s" onmouseover="this.style.color=\'rgba(255,255,255,1)\'" onmouseout="this.style.color=\'rgba(255,255,255,0.6)\'" title="Delete category">üóëÔ∏è</button>' : '') + '<button onclick="toggleAddForm(\'' + categoryId + '\')" class="btn" style="font-size:10px;padding:6px 16px">+ Add</button></div></div>';
        html += '<div id="addForm-' + categoryId + '" class="hidden" style="padding:16px;background:#f8fafc"><div class="form-grid"><input type="text" id="emoji-' + categoryId + '" placeholder="‚≠ê" maxlength="2" class="input emoji-input"><input type="text" id="name-' + categoryId + '" placeholder="Activity name" class="input"><input type="number" id="points-' + categoryId + '" placeholder="Pts" class="input points-input"></div><div style="display:flex;gap:8px"><button onclick="addPreset(\'' + categoryId + '\')" class="btn" style="flex:1">Add</button><button onclick="toggleAddForm(\'' + categoryId + '\')" class="btn btn-secondary">Cancel</button></div></div>';
        html += '<div style="padding:12px">';
        items.forEach(action => {
          html += '<div class="action-item"><button onclick="logAction(' + action.id + ',\'' + categoryId + '\', event)" class="action-btn"><span style="display:flex;align-items:center"><span class="emoji">' + action.emoji + '</span><span class="name">' + action.name + '</span></span><span class="points">+' + action.points + '</span></button><button onclick="deletePreset(\'' + categoryId + '\',' + action.id + ')" class="delete-btn">üóëÔ∏è</button></div>';
        });
        html += '</div></div>';
      });
      
      html += '<div class="card" style="text-align:center;padding:32px"><button onclick="addNewCategory()" class="btn" style="width:100%">+ Add New Category</button></div>';
      
      container.innerHTML = html;
    }

    function renderRewards() {
      const container = document.getElementById('rewardsView');
      const unredeemed = state.rewards.filter(r => !r.redeemed);
      const redeemed = state.rewards.filter(r => r.redeemed);
      
      let html = '<div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px"><h3 class="card-title" style="margin:0">Your Rewards</h3><button onclick="document.getElementById(\'addRewardForm\').classList.toggle(\'hidden\')" class="btn btn-secondary" style="padding:6px 16px;font-size:10px">+ Add</button></div>';
      html += '<div id="addRewardForm" class="hidden" style="background:#f8fafc;padding:16px;margin-bottom:24px;border:1px solid #e2e8f0"><div style="display:grid;grid-template-columns:auto 1fr;gap:8px;margin-bottom:12px"><input type="text" id="rewardIcon" value="üéÅ" class="input emoji-input"><input type="text" id="rewardName" placeholder="Reward name" class="input"></div><input type="number" id="rewardCost" placeholder="Points cost" class="input" style="margin-bottom:12px"><button onclick="addReward()" class="btn" style="width:100%">Add Reward</button></div>';
      
      unredeemed.forEach(reward => {
        const canRedeem = state.totalPoints >= reward.cost;
        const progress = Math.min((state.totalPoints / reward.cost) * 100, 100);
        html += '<div class="reward-card' + (canRedeem ? ' unlockable' : '') + '"><div style="display:flex;justify-content:space-between;margin-bottom:16px"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:28px">' + reward.icon + '</span><div><div style="font-weight:300">' + reward.name + '</div><div style="font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.05em">' + reward.cost + ' pts</div></div></div><div style="display:flex;gap:8px"><button onclick="redeemReward(' + reward.id + ')" class="btn" style="padding:8px 24px;font-size:10px' + (!canRedeem ? ';background:#cbd5e1;color:#64748b;cursor:not-allowed' : '') + '">' + (canRedeem ? 'Redeem' : 'Locked') + '</button><button onclick="deleteReward(' + reward.id + ')" class="delete-btn">üóëÔ∏è</button></div></div><div class="progress-bar"><div class="progress-fill' + (canRedeem ? ' ready' : '') + '" style="width:' + progress + '%"></div></div><div style="text-align:right;font-size:10px;color:#64748b;text-transform:uppercase;letter-spacing:0.05em">' + (canRedeem ? 'Ready to redeem' : (reward.cost - state.totalPoints) + ' more needed') + '</div></div>';
      });
      
      if (redeemed.length > 0) {
        html += '<div style="margin-top:32px;padding-top:32px;border-top:1px solid #e2e8f0"><h4 style="font-weight:300;letter-spacing:0.1em;text-transform:uppercase;font-size:12px;margin-bottom:16px">Redeemed (' + redeemed.length + ')</h4>';
        redeemed.forEach(reward => {
          html += '<div style="display:flex;align-items:center;justify-content:space-between;padding:12px;background:#f8fafc;border:1px solid #e2e8f0;margin-bottom:8px"><div style="display:flex;align-items:center;gap:12px"><span style="font-size:20px;opacity:0.5">' + reward.icon + '</span><span style="font-weight:300;color:#64748b">' + reward.name + '</span></div><button onclick="undoReward(' + reward.id + ')" style="font-size:10px;padding:6px 16px;border:1px solid #cbd5e1;background:white;color:#475569;cursor:pointer;letter-spacing:0.1em;text-transform:uppercase;font-weight:300">UNDO</button></div>';
        });
        html += '</div>';
      }
      
      html += '</div>';
      container.innerHTML = html;
    }

    function renderHistory() {
      const container = document.getElementById('historyView');
      let html = '<div class="card"><h3 class="card-title">Activity Log</h3>';
      if (state.history.length === 0) {
        html += '<p style="text-align:center;color:#94a3b8;padding:48px 0;font-weight:300;font-size:14px">No activity yet</p>';
      } else {
        state.history.forEach((item, idx) => {
          const displayName = item.name + (item.bonusText || '');
          html += '<div class="history-item"><div class="history-left"><span style="font-size:20px">' + item.emoji + '</span><div style="flex:1"><div style="font-weight:300">' + displayName + '</div><div class="timestamp">' + item.timestamp + '</div></div></div><div class="history-right"><span style="font-weight:300">+' + item.points + '</span><button onclick="deleteHistoryItem(' + idx + ')" class="delete-btn">üóëÔ∏è</button></div></div>';
        });
      }
      html += '</div>';
      container.innerHTML = html;
    }

    function renderVision() {
      const container = document.getElementById('visionView');
      const hasContent = state.futureVision.q1 || state.futureVision.q2 || state.futureVision.q3 || state.futureVision.q4 || state.futureVision.q5;
      
      let html = '<div class="card" style="background: linear-gradient(to bottom right, rgba(139, 92, 246, 0.05), rgba(59, 130, 246, 0.05));">';
      html += '<h3 class="card-title">Your Future Self</h3>';
      html += '<p style="font-size: 12px; color: #64748b; margin-bottom: 8px; font-weight: 300; text-align: center;">This is who you\'re becoming</p>';
      
      if (state.futureVision.lastUpdated) {
        html += '<p style="font-size: 10px; color: #94a3b8; margin-bottom: 24px; font-weight: 300; text-align: center; text-transform: uppercase; letter-spacing: 0.05em;">Last updated on ' + state.futureVision.lastUpdated + '</p>';
      } else {
        html += '<div style="margin-bottom: 24px;"></div>';
      }
      
      if (!hasContent) {
        html += '<p style="text-align:center;color:#94a3b8;padding:48px 0;font-weight:300;font-size:14px">You haven\'t completed your vision yet.</p>';
        html += '<div style="text-align: center;"><button onclick="forceShowOnboarding()" class="btn">Start Vision Exercise</button></div>';
      } else {
        onboardingQuestions.forEach((q, idx) => {
          const answer = state.futureVision[q.key] || '';
          html += '<div style="margin-bottom: 24px; padding: 20px; background: rgba(255,255,255,0.7); border: 1px solid #e2e8f0;">';
          html += '<div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 8px; font-weight: 300;">' + q.question + '</div>';
          if (answer) {
            html += '<div style="font-size: 14px; line-height: 1.7; color: #0f172a; font-weight: 300; white-space: pre-wrap;">' + answer + '</div>';
          } else {
            html += '<div style="font-size: 14px; line-height: 1.7; color: #94a3b8; font-style: italic;">Not answered yet</div>';
          }
          html += '</div>';
        });
        html += '<div style="text-align: center; margin-top: 24px;"><button onclick="forceShowOnboarding()" class="btn btn-secondary">Edit Your Vision</button></div>';
      }
      
      html += '</div>';
      container.innerHTML = html;
    }

    function render() {
      updatePoints();
      if (state.userName) {
        const displayElem = document.getElementById('userNameDisplay');
        const inputElem = document.getElementById('userNameInput');
        if (displayElem) displayElem.textContent = state.userName;
        if (inputElem) inputElem.value = state.userName;
      }
      updateStepsToggleButton();
      updateBonusBadge();
      initLogoSpinner();
      renderEarn();
    }

    // Initialize app - run immediately or when DOM is ready
    if (document.readyState === 'loading') {
      window.addEventListener('DOMContentLoaded', () => {
        loadData();
        setTimeout(() => showOnboarding(), 500);
      });
    } else {
      loadData();
      setTimeout(() => showOnboarding(), 500);
    }
  </script>
</body>
</html>
